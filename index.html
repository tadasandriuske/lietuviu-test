<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragula Example with Bootstrap</title>

    <!-- Include Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Include Dragula CSS -->
    <link href="https://cdn.jsdelivr.net/npm/dragula@3.7.3/dist/dragula.min.css" rel="stylesheet">
    <style>
        body {
          font-family: Arial, sans-serif;
          padding: 20px;
        }

        .field {
          background-color: #e0e0e0;
          padding: 10px;
          margin: 10px;
          width: 100%;
        }

        .item {
          padding: 10px;
          margin: 5px;
          background-color: #e0e0e0;
          cursor: move;
          border: 1px solid #ccc;
          border-radius: 5px;
        }

        /* Ensure the drop targets fill the column */
        #options-field, #answers-field {
            min-height: 500px;
        }

        #result-message {
          margin-top: 20px;
          font-weight: bold;
        }
    </style>
</head>
<body>

  <div class="container">
    <!-- First row: Left column empty, Right column with item -->
    <div class="row">
      <div class="col-12 col-md-6">
        <div id="options-field-div" class="col-12">
          <div id="options-field" class="field"></div>
        </div>
      </div>

      <!-- Second row: Draggable items and Bottom right -->
      <div class="col-12 col-md-6">
        <div class="col-12">
          <div id="title-field" class="field">
            Pavadinimas
          </div>
        </div>

        <!-- Right column with bottom-right item -->
        <div id="answers-field-div" class="col-12">
          <div id="answers-field" class="field">
            Tekstas
          </div>
        </div>
      </div>
    </div>

    <!-- Check answer button -->
    <div class="row">
      <div class="col-12">
        <button id="check-answer-btn" class="btn btn-primary">Check Answer</button>
        <div id="result-message"></div>
      </div>
    </div>
  </div>

  <!-- Include Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pzjw8f+ua7Kw1TIq0r3ry7kAop5z3XMJ4g/4dWl56h3xW00tiy8b6Bc5tbtiq5x7" crossorigin="anonymous"></script>
  <!-- Include Dragula JS -->
  <script src="https://cdn.jsdelivr.net/npm/dragula@3.7.3/dist/dragula.min.js"></script>

  <script>
    // Paragraph library with title and paragraph pairs
    const paragraphLibrary = [
      {
        title: "Sample Title 1",
        paragraph: "This is the second example paragraph. It also contains several sentences. The user needs to drag and drop the sentences into the correct order. The title is included at the top."
      },
      {
        title: "Sample Title 2",
        paragraph: "This is the second example paragraph. It also contains several sentences. The user needs to drag and drop the sentences into the correct order. The title is included at the top."
      }
    ];

    // Function to split a paragraph into sentences
    function splitParagraphToSentences(paragraph) {
      return paragraph.split(/(?<=\.)\s+/); // Split by period followed by space
    }

    // Function to shuffle the array of sentences
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]]; // Swap elements
      }
      return array;
    }

    // Select a random item from the library
    const selectedItem = paragraphLibrary[0];
    const originalTitle = selectedItem.title;
    const originalParagraph = selectedItem.paragraph;

    // Split the paragraph into sentences
    const sentences = splitParagraphToSentences(originalParagraph);

    // Combine the title and sentences into one array
    const combinedItems = [originalTitle, ...sentences];

    // Shuffle the combined items (title + sentences)
    const shuffledItems = shuffleArray(combinedItems);

    // Append shuffled items (title + sentences) as draggable items
    const optionsField = document.getElementById('options-field');
    shuffledItems.forEach(item => {
      const itemDiv = document.createElement('div');
      itemDiv.classList.add('item');
      itemDiv.textContent = item;
      optionsField.appendChild(itemDiv);
    });

    // Initialize Dragula with the correct containers
    dragula([document.getElementById('options-field'), document.getElementById('title-field'), document.getElementById('answers-field')])
      .on('drag', function (el) {
        console.log("Dragging:", el.textContent);

        // Disable touch scrolling while dragging
        if (window.ontouchstart !== undefined) {
          document.body.style.overflow = 'hidden'; // Disable body scroll
        }
      })
      .on('dragend', function (el) {
        console.log("Drag ended:", el.textContent);

        // Re-enable scrolling when drag ends
        if (window.ontouchstart !== undefined) {
          document.body.style.overflow = ''; // Re-enable body scroll
        }
      })
      .on('drop', function (el, target) {
        console.log("Dropped:", el.textContent, "into", target.id);
      });

    // Add touch event listener for scroll behavior on mobile
    let isDragging = false;
    let dragStartY = 0;

    document.addEventListener('touchstart', function (event) {
      if (event.target.classList.contains('item')) {
        event.preventDefault(); // Prevent initial scrolling right away
        dragStartY = event.touches[0].clientY;
        isDragging = true;
      }
    });

    document.addEventListener('touchmove', function (event) {
      if (isDragging) {
        const dragY = event.touches[0].clientY;
        const screenHeight = window.innerHeight;

        // Allow scrolling only near the top or bottom
        if (dragY < 50) {
          window.scrollBy(0, -10); // Scroll up when near top
        } else if (dragY > screenHeight - 50) {
          window.scrollBy(0, 10); // Scroll down when near bottom
        }

        // Prevent default behavior (page refresh, scrolling) until we are near edges
        event.preventDefault();
      }
    });

    document.addEventListener('touchend', function () {
      isDragging = false;
    });

    // Button event to check the answer
    document.getElementById('check-answer-btn').addEventListener('click', function () {
      // Get the order of items in the answers field
      const answersField = document.getElementById('answers-field');
      const answerItems = answersField.querySelectorAll('.item');
      const answerList = Array.from(answerItems).map(item => item.textContent);

      // Get the title from the title field
      const titleField = document.getElementById('title-field');
      const titleItems = titleField.querySelectorAll('.item');
      const titleList = Array.from(titleItems).map(item => item.textContent);

      // Check if the order of items in the answers field matches the original order (including title)
      const resultMessage = document.getElementById('result-message');

      // Check if the title and sentences in the answers field match the original order
      function arraysAreEqual(arr1, arr2) {
        if (arr1.length !== arr2.length) return false; // If lengths don't match, arrays are not equal
        for (let i = 0; i < arr1.length; i++) {
          if (arr1[i].trim() !== arr2[i].trim()) return false; // Trim each item and compare
        }
        return true; // If all elements match, arrays are equal
      }

      // The correct answer should include the title as the first item, followed by the sentences in order
      const sentencesCorrect = arraysAreEqual(answerList, sentences); // Compare sentences
      resultMessage.textContent = sentencesCorrect ? 'Correct!' : 'Incorrect!';
    });

  </script>

</body>
</html>
